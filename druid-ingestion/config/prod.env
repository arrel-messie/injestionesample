# config/prod.env
# Configuration pour l'environnement de production

# ============================================
# Kafka Configuration
# ============================================
KAFKA_BOOTSTRAP_SERVERS="kafka-prod.internal:9092"
# Les credentials sont injectés via GitLab CI/CD Variables (KAFKA_PROD_USER, KAFKA_PROD_PASSWORD)
KAFKA_SASL_JAAS_CONFIG="org.apache.kafka.common.security.plain.PlainLoginModule required username='${KAFKA_PROD_USER}' password='${KAFKA_PROD_PASSWORD}';"
KAFKA_TOPIC="settlement-transactions-prod"

# Kafka Consumer Tuning (Production)
KAFKA_FETCH_MIN_BYTES=1048576
KAFKA_FETCH_MAX_WAIT_MS=500
KAFKA_MAX_POLL_RECORDS=500
KAFKA_SESSION_TIMEOUT_MS=30000
KAFKA_HEARTBEAT_INTERVAL_MS=3000
KAFKA_MAX_POLL_INTERVAL_MS=300000

# ============================================
# Protobuf Schema Configuration
# ============================================
PROTO_DESCRIPTOR_FILE="settlement_transaction.desc"
PROTO_MESSAGE_TYPE="com.company.PaymentTransactionEvent"

# ============================================
# Druid Datasource Configuration
# ============================================
DATASOURCE_NAME="idm_settlement_snapshot"
TIMESTAMP_COLUMN="settlement_ts"
TIMESTAMP_FORMAT="auto"

# ============================================
# Ingestion Configuration (Production - full scale)
# ============================================
TASK_COUNT=10
REPLICAS=2
TASK_DURATION="PT1H"
USE_EARLIEST_OFFSET=false
USE_TRANSACTION=true

# Période de polling et timeouts
START_DELAY="PT5S"
PERIOD="PT30S"
COMPLETION_TIMEOUT="PT1H"
LATE_MESSAGE_REJECTION_PERIOD="PT1H"
POLL_TIMEOUT=100
MINIMUM_MESSAGE_TIME="1970-01-01T00:00:00.000Z"

# ============================================
# Granularité et rollup
# ============================================
SEGMENT_GRANULARITY="DAY"
QUERY_GRANULARITY="NONE"
ROLLUP=false

# ============================================
# Tuning Configuration (Production)
# ============================================
MAX_ROWS_IN_MEMORY=500000
MAX_BYTES_IN_MEMORY=536870912
MAX_ROWS_PER_SEGMENT=5000000

# Persistence
INTERMEDIATE_PERSIST_PERIOD="PT10M"
MAX_PENDING_PERSISTS=2

# Parsing exceptions
REPORT_PARSE_EXCEPTIONS=true
LOG_PARSE_EXCEPTIONS=true
MAX_PARSE_EXCEPTIONS=10000
MAX_SAVED_PARSE_EXCEPTIONS=100

# Offsets
RESET_OFFSET_AUTOMATICALLY=false
SKIP_SEQUENCE_NUMBER_AVAILABILITY_CHECK=false

# Handoff
HANDOFF_CONDITION_TIMEOUT=900000
INTERMEDIATE_HANDOFF_PERIOD="P2147483647D"

# Threads
CHAT_RETRIES=8

# Timeouts
HTTP_TIMEOUT="PT10S"
SHUTDOWN_TIMEOUT="PT80S"
OFFSET_FETCH_PERIOD="PT30S"

# Partitioning
PARTITIONS_SPEC_TYPE="hashed"
# Secondary partitioning on high cardinality dimension (5500 distinct values, used in 80% of queries)
SECONDARY_PARTITION_DIMENSIONS='["payer_access_manager_id"]'
TARGET_ROWS_PER_SEGMENT=5000000
MAX_SPLIT_SIZE=1073741824
MAX_INPUT_SEGMENT_BYTES_PER_TASK=10737418240

# ============================================
# Druid Overlord URL
# ============================================
DRUID_OVERLORD_URL="http://druid-overlord-prod.internal:8090"

# ============================================
# Environment identifier
# ============================================
ENVIRONMENT="prod"
